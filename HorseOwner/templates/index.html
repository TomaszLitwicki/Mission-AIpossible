{% extends "base.html" %}
{% block content %}
  <h1>Dashboard</h1>

  <!-- A) Twoje konie (dynamicznie, bez zdjÄ™Ä‡) -->
  <section class="mb-4">
    <h2>ğŸ´ Twoje konie</h2>

    {% if horses %}
      <div class="grid-cards">
        {% for h in horses %}
          <article class="card">
            <div class="card-emoji" aria-hidden="true">ğŸ´</div>
            <div class="card-body">
              <h3 class="card-title">{{ h["name"] }}</h3>
              <p class="card-meta">
                {{ h["breed"] or "brak rasy" }} â€¢ {{ h["color"] or "maÅ›Ä‡ n/d" }}
              </p>
              <p class="card-note">{{ h["notes"] or "â€”" }}</p>
              <a class="btn btn-primary mt-2" href="{{ url_for('horse_detail', horse_id=h['id']) }}">Profil konia</a>
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p>Brak koni w bazie. Dodaj wpisy lub uruchom skrypt seedujÄ…cy.</p>
    {% endif %}
  </section>

<!-- index.html â€” sekcja â€Ostatnie treningiâ€ -->
<section class="mb-4">
  <h2>ğŸ‹ï¸ Ostatnie treningi</h2>

  {% if last_trainings %}
    <table class="table">
      <thead>
        <tr>
          <th>Data</th>
          <th>KoÅ„</th>
          <th>Typ</th>
          <th>Czas</th>
          <th>Ocena</th>
          <th>ğŸ˜Š</th>
        </tr>
      </thead>
      <tbody>
        {% for t in last_trainings %}
          <tr>
            <td>{{ t["date"] }}{% if t["time"] %} {{ t["time"] }}{% endif %}</td>
            <td>{{ t["horse_name"] }}</td>
            <td>
              {# prosty mapping etykiet #}
              {% set labels = {
                'dressage':'UjeÅ¼dÅ¼enie',
                'jumping':'Skoki',
                'trail':'Teren',
                'groundwork':'Z ziemi',
                'other':'Inne'
              } %}
              {{ labels.get(t["type"], t["type"]) }}
            </td>
            <td>{{ t["duration_min"] }} min</td>
            <td>{{ t["score"] if t["score"] is not none else 'â€”' }}/10</td>
            <td>{{ 'TAK' if t["satisfied"] == 1 else 'NIE' }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Brak treningÃ³w. Dodaj pierwszy wpis w zakÅ‚adce <strong>Treningi</strong>.</p>
  {% endif %}
</section>


<section class="mb-4">
  <h2>ğŸ’‰ NadchodzÄ…ce zabiegi</h2>

  {% if pending_treatments %}
    <table class="table">
      <thead>
        <tr><th>Zabieg</th><th>KoÅ„</th><th>Data</th><th>Status</th></tr>
      </thead>
      <tbody>
        {% for z in pending_treatments %}
          {% set is_overdue = z['date'] < today %}
          <tr class="{% if is_overdue %}overdue{% endif %}">
            <td>{{ z['name'] }}</td>
            <td>{{ z['horse_name'] }}</td>
            <td>{{ z['date'] }}</td>
            <td>{% if is_overdue %}ğŸ”´ po terminie{% else %}ğŸŸ¡ plan{% endif %}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Brak zaplanowanych zabiegÃ³w.</p>
  {% endif %}
</section>

{% endblock %}
